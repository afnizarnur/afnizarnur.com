---
import BaseLayout from "./BaseLayout.astro"
import SettingsPanel from "../components/SettingsPanel.astro"
import type { Metadata } from "../config/meta"

interface Props extends Partial<Metadata> {
	title: string
}

const props = Astro.props
---

<BaseLayout {...props}>
	<div class="flex flex-col md:flex-row max-w-[1440px] mx-auto p-0">
		<div
			class="w-full md:w-1/3 max-w-full md:max-w-[420px] flex-shrink-0 md:sticky md:top-0 md:self-start flex flex-col h-auto md:h-screen border-b md:border-b-0 md:border-r border-border"
			role="complementary"
			aria-label="Site sidebar"
		>
			<div
				class="flex justify-between items-center p-[24px_24px_0px_48px]"
			>
				<a href="/" class="block" aria-label="Go to homepage">
					<img
						src="/avatar.png"
						alt="Afnizar Nur Ghifari"
						class="rounded-full object-cover"
						width="36"
						height="36"
					/>
				</a>
				<button
					id="menu-toggle"
					class="bg-transparent border-none cursor-pointer p-1 flex items-center justify-center hover:opacity-70 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2"
					aria-label="Toggle menu"
					aria-expanded="false"
					aria-controls="settings-panel"
				>
					<svg
						width="24"
						height="24"
						viewBox="0 0 24 24"
						class="menu-icon"
						xmlns="http://www.w3.org/2000/svg"
						aria-hidden="true"
					>
						<rect
							class="line line1"
							x="2"
							y="6"
							width="20"
							height="2"></rect>
						<rect
							class="line line2"
							x="2"
							y="16"
							width="20"
							height="2"></rect>
					</svg>
				</button>
			</div>

			<div class="px-12 md:px-[48px] relative">
				<SettingsPanel />
			</div>

			<div
				class="p-[44px_24px_24px_48px] overflow-y-auto flex-grow flex flex-col"
			>
				<h1 class="mb-8">Afnizar<br />Nur Ghifari</h1>
				<slot name="sidebar" />
			</div>
		</div>
		<main
			id="main-content"
			class="flex-grow p-6 md:p-6 md:max-w-[calc(100%-420px)]"
		>
			<slot />
		</main>
	</div>

	<style>
		.menu-icon {
			fill: var(--text-primary);
		}

		.line {
			transform-origin: center;
			transition: transform 0.3s ease;
		}

		.opened .line1 {
			transform: translate(-4px, 4px) rotate(45deg);
		}

		.opened .line2 {
			transform: translate(-4px, -3px) rotate(-45deg);
		}
	</style>

	<script>
		// Menu toggle functionality
		const menuToggle = document.getElementById("menu-toggle")
		const settingsPanel = document.getElementById("settings-panel")

		menuToggle?.addEventListener("click", () => {
			menuToggle.classList.toggle("opened")
			menuToggle.setAttribute(
				"aria-expanded",
				menuToggle.classList.contains("opened").toString()
			)
			settingsPanel?.classList.toggle("hidden")
		})

		// Close settings panel when clicking outside
		document.addEventListener("click", (e) => {
			if (
				!settingsPanel?.contains(e.target as Node) &&
				!menuToggle?.contains(e.target as Node) &&
				settingsPanel &&
				!settingsPanel.classList.contains("hidden")
			) {
				settingsPanel.classList.add("hidden")
				menuToggle?.classList.remove("opened")
				menuToggle?.setAttribute("aria-expanded", "false")
			}
		})
	</script>
</BaseLayout>
