---
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import PortableText from '../../components/PortableText.astro';
import { getProjectBySlug, getAllProjectSlugs } from '../../server/data';

export async function getStaticPaths() {
  const projectSlugs = await getAllProjectSlugs();

  return projectSlugs.map((item) => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;
const project = await getProjectBySlug(slug);

if (!project) {
  return Astro.redirect('/404');
}
---

<ProjectLayout project={project}>
  <PortableText value={project.body} />
</ProjectLayout>
