---
import PostLayout from "../../layouts/PostLayout.astro"
import PortableText from "../../components/PortableText.astro"
import { getPostBySlug, getAllPostSlugs } from "../../server/data"

export async function getStaticPaths() {
    const postSlugs = await getAllPostSlugs()

    return postSlugs.map((item) => ({
        params: { slug: item.slug },
    }))
}

const { slug } = Astro.params
const post = await getPostBySlug(slug)

if (!post) {
    return Astro.redirect("/404")
}
---

<PostLayout post={post}>
    <PortableText value={post.body} />
</PostLayout>
