---
import type { NavigationItem } from "@afnizarnur/ui"
import { Palette, GearSix } from 'phosphor-react'
import IconButton from './IconButton.astro'

export interface Props {
    items: NavigationItem[]
    currentPath?: string
}

const { items, currentPath } = Astro.props

// Get current time in HH:MM_AM/PM format
function getFormattedTime(): string {
    const now = new Date()
    const hours = String(now.getHours()).padStart(2, "0")
    const minutes = String(now.getMinutes()).padStart(2, "0")
    const period = now.getHours() >= 12 ? "PM" : "AM"
    return `ID ${hours}:${minutes}_${period}`
}

// Normalize navigation href
function normalizeHref(href: string): string {
    if (href.startsWith("http")) {
        return href
    }
    return href.startsWith("/") ? href : `/${href}`
}

// Check if navigation item is active
function isNavItemActive(itemHref: string, path: string): boolean {
    const normalizedHref = normalizeHref(itemHref)
    return path === normalizedHref
}

const timeString = getFormattedTime()
---

<nav
    class="sticky top-0 z-40 h-[66px] border-b-[2px] border-border-tertiary px-[110px] py-2 grid grid-cols-8 gap-6 items-center bg-background-primary"
    role="navigation"
    aria-label="Main navigation"
>
    {/* Col 1-2 - Logo */}
    <div class="col-span-2">
        <a
            href="/"
            class="text-eyebrow-1 text-text-primary transition-colors duration-150 hover:text-text-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-text-primary rounded"
            aria-label="Afnizar Nur Ghifari - Home"
            title="Go to homepage"
        >
            Afnizar_Nur_Ghifari
        </a>
    </div>

    {/* Col 3-5 - Navigation Menu */}
    <div class="col-span-3">
        <ul class="flex gap-48 list-none p-0 m-0">
            {
                items.map((item) => {
                    const href = normalizeHref(item.href)
                    const isActive = isNavItemActive(item.href, currentPath || "")

                    return (
                        <li key={item.href}>
                            <a
                                href={href}
                                target={item.newTab ? "_blank" : undefined}
                                rel={item.newTab ? "noopener noreferrer" : undefined}
                                class={`text-eyebrow-1 transition-colors duration-150 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-text-primary ${
                                    isActive
                                        ? "text-text-primary cursor-default"
                                        : "text-text-secondary hover:text-text-primary active:text-text-primary"
                                }`}
                                aria-current={isActive ? "page" : undefined}
                            >
                                {item.title}
                            </a>
                        </li>
                    )
                })
            }
        </ul>
    </div>

    {/* Col 6-7 - Time Display */}
    <div class="col-span-2">
        <time class="text-eyebrow-1 text-text-secondary" datetime={new Date().toISOString()}>
            {timeString}
        </time>
    </div>

    {/* Col 8 - Icon Buttons */}
    <div class="col-span-1 flex justify-end gap-4">
        <IconButton
            icon={Palette}
            ariaLabel="Toggle theme"
            size={24}
        />
        <IconButton
            icon={GearSix}
            ariaLabel="Open settings"
            size={24}
        />
    </div>
</nav>
